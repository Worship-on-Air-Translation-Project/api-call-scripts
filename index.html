<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Live Translation</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: #f9f9f9;
      font-family: sans-serif;
      height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .wrapper {
      text-align: center;
      width: 90%;
      max-width: 800px;
    }

    h1 {
      color: #0ea5e9;
    }

    #output {
      margin-top: 30px;
      background: #e2e8f0;
      padding: 16px;
      border-radius: 10px;
      height: 400px;
      overflow-y: auto;
      text-align: left;
    }

    .pair {
      margin-bottom: 20px; /* space between transcript+translation blocks */
      padding-bottom: 10px;
      border-bottom: 1px solid #cbd5e1;
    }

    .transcript {
      font-weight: bold;
      margin-bottom: 6px;
      color: #111827;
    }

    .translation {
      color: #334155;
    }
  </style>
</head>
<body>
  <div class="wrapper">
    <h1>Worship On Air - AI Translation</h1>
    <p><em>English â†’ Korean</em></p>

    <div id="output"></div>
  </div>

<script>
  // Build WebSocket URL dynamically
  const scheme = location.protocol === "https:" ? "wss" : "ws";
  const wsUrl = `${scheme}://${location.host}/ws/translate`;
  const ws = new WebSocket(wsUrl);

  const output = document.getElementById("output");

  ws.onmessage = (event) => {
    try {
      const data = JSON.parse(event.data);

      if (data.transcript && data.translation) {
        const pair = document.createElement("div");
        pair.className = "pair";

        const transcript = document.createElement("div");
        transcript.className = "transcript";
        transcript.textContent = data.transcript;

        const translation = document.createElement("div");
        translation.className = "translation";
        translation.textContent = data.translation;

        pair.appendChild(transcript);
        pair.appendChild(translation);

        output.appendChild(pair);

        // Auto-scroll
        output.scrollTop = output.scrollHeight;
      } else {
        console.log("Message:", data);
      }
    } catch (e) {
      console.warn("Non-JSON message:", event.data);
    }
  };

  ws.onerror = () => {
    const errorLine = document.createElement("div");
    errorLine.textContent = "[WebSocket Error]";
    errorLine.style.color = "red";
    output.appendChild(errorLine);
  };
</script>

</body>
</html>